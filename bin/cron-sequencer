#!/usr/bin/perl

use v5.20.0;
use warnings;

use Cron::Sequencer::CLI qw(parse_argv);
require Cron::Sequencer::Output;
require Cron::Sequencer;
require Pod::Usage;

$main::VERSION = $Cron::Sequencer::VERSION;
my ($start, $end, $output, @input) = parse_argv(\&Pod::Usage::pod2usage, @ARGV);

=head1 NAME

cron-sequencer - show the sequence of commands that cron would run

=head1 SYNOPSIS

    cron-sequencer crontab-file # show today's events

TODO

=cut

my $crontab = Cron::Sequencer->new(@input);

my $formatter = Cron::Sequencer::Output->new(@$output);
my $gap = "\n\n";

my $not_first;

for my $group ($crontab->sequence($start, $end)) {
    print $gap
        if $not_first++;

    print map { "$_\n" } $formatter->format_group(@$group);
}
