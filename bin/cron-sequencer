#!/usr/bin/perl

use v5.20.0;
use warnings;

use Cron::Sequencer::CLI;
require Cron::Sequencer::Output;
require Cron::Sequencer;
use Getopt::Long;
use Pod::Usage;

my %options;

unless(GetOptions(\%options,
                  'show=s',
                  'from=s',
                  'to=s',
                  'hide-env',
                  'env=s@',
              )) {
    pod2usage(exitval => 255, verbose => 1);
}

my ($start, $end) = calculate_start_end(\%options);

my $file = shift;

pod2usage(exitval => 255)
    unless defined $file;

=head1 NAME

cron-sequencer - show the sequence of commands that cron would run

=head1 SYNOPSIS

    cron-sequencer crontab-file # show today's events

TODO

=cut

my $crontab = Cron::Sequencer->new($file);

my $formatter = Cron::Sequencer::Output->new(%options{qw(env hide-env)});
my $gap = "\n\n";

my $not_first;

for my $group ($crontab->sequence($start, $end)) {
    print $gap
        if $not_first++;

    print map { "$_\n" } $formatter->format_group(@$group);
}
